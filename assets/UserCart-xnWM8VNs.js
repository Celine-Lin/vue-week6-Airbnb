import{r as b,o as l,c,a as t,F as v,i as $,e as C,t as u,b as n,w,d as g,f as k,n as _}from"./index-6Z8LQik9.js";var V={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_API_NAME:"vue-week2-new",BASE_URL:"/vue-week6-Airbnb/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const L={class:"container py-48"},I={class:"text-end"},P=["disabled"],E={class:"table align-middle"},A=t("thead",null,[t("tr",null,[t("th",{width:"10%"}),t("th",{width:"40%"},"品名"),t("th",{width:"20%"},"數量/單位"),t("th",{width:"15%",class:"text-end"},"單價"),t("th",{width:"15%",class:"text-end"},"總計")])],-1),B=["disabled","onClick"],D={class:"input-group input-group-sm",style:{"max-width":"200px","min-width":"120px"}},N={class:"input-group my-1"},Q=["disabled","onClick"],U=["disabled","onClick"],S={class:"form-control text-center"},q=["disabled","onClick"],R={class:"text-end"},T={class:"text-end"},O=t("td",{colspan:"4",class:"text-end fw-bold"},"總金額",-1),F={class:"text-end fw-bold"},M={class:"my-96 row justify-content-center"},j={class:"mb-24"},z=t("label",{for:"email",class:"form-label"},"Email",-1),x={class:"mb-24"},Z=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),G={class:"mb-24"},H=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),J={class:"mb-24"},K=t("label",{for:"address",class:"form-label"},"收件人地址",-1),W={class:"mb-24"},X=t("label",{for:"message",class:"form-label"},"留言",-1),Y={class:"text-end"},tt=t("button",{type:"submit",class:"btn btn-danger"},"送出訂單",-1),et=["onClick"],{VITE_APP_API_URL:h,VITE_APP_API_NAME:p}=V,st={data(){return{products:[],tempProductOuter:{},cartData:[],status:{addCartLoading:"",changeCartQtyLoading:"",removeCartItemLoading:""},form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{getCarts(){this.$http.get(`${h}/api/${p}/cart`).then(o=>{this.cartData=o.data.data}).catch(()=>{this.$swal.fire({icon:"error",title:"很抱歉，目前無法讀取購物車內容。"})})},changeCartQty(o,e=1){this.status.changeCartQtyLoading=o.id;const a={product_id:o.product_id,qty:e};this.$http.put(`${h}/api/${p}/cart/${o.id}`,{data:a}).then(()=>{this.status.changeCartQtyLoading="",this.getCarts()}).catch(()=>{this.$swal.fire({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:1500,icon:"error",title:"請重新操作。"})})},removeCartItem(o){this.status.removeCartItemLoading=o,this.$http.delete(`${h}/api/${p}/cart/${o}`).then(()=>{this.status.removeCartItemLoading="",this.getCarts()})},removeCart(){this.$swal.fire({title:"確定要清除購物車所有內容？",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"取消",confirmButtonText:"刪除"}).then(o=>{o.isConfirmed&&this.$http.delete(`${h}/api/${p}/carts`).then(()=>{this.$swal.fire({icon:"success",title:"成功清除購物車！"}),this.getCarts()}).catch(()=>{this.$swal.fire({icon:"error",title:"清除失敗，請重新操作。"})})})},isName(o){return o.length===0?"姓名 為必填欄位":/^[a-zA-Z0-9\u4e00-\u9fa5]+$/g.test(o)?!(o.length<3)||"姓名 不能小於3個字":"姓名 不能包含特殊字元"},isPhone(o){return o.length===0?"電話 為必填欄位":/^(09)[0-9]{8}$/.test(o)||"需要填寫正確的台灣手機號碼"},onSubmit(){if(this.cartData.carts.length===0){this.$swal.fire({title:"請先加入商品到購物車！",icon:"warning"});return}this.$http.post(`${h}/api/${p}/order`,{data:this.form}).then(()=>{this.$refs.form.resetForm(),this.getCarts(),this.$swal.fire({icon:"success",title:"訂單送出成功！"})}).catch(()=>{this.$swal.fire({title:"訂單送出失敗，請重新操作。",icon:"error"})})}},mounted(){this.getCarts()}},at=Object.assign(st,{inheritAttrs:!1},{__name:"UserCart",setup(o){return(e,a)=>{const d=b("font-awesome-icon"),r=b("v-field"),f=b("error-message"),y=b("v-form");return l(),c("main",L,[t("div",I,[t("button",{disabled:e.cartData.total===0,class:"btn btn-outline-danger",type:"button",onClick:a[0]||(a[0]=s=>e.removeCart())}," 清空購物車 ",8,P)]),t("table",E,[A,t("tbody",null,[e.cartData.carts?(l(!0),c(v,{key:0},$(e.cartData.carts,s=>(l(),c("tr",{key:s.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-none btn-sm",disabled:s.id===e.status.removeCartItemLoading,onClick:m=>e.removeCartItem(s.id)},[s.id===e.status.removeCartItemLoading?(l(),g(d,{key:0,icon:"fa-solid fa-spinner","spin-pulse":""})):(l(),g(d,{key:1,icon:"x"}))],8,B)]),t("td",null,u(s.product.title),1),t("td",null,[t("div",D,[t("div",N,[s.qty===1?(l(),c("button",{key:0,type:"button",class:"input-group-text",id:"basic-addon2",disabled:s.id===e.status.changeCartQtyLoading,onClick:m=>e.removeCartItem(s.id)},[n(d,{icon:"trash-can"})],8,Q)):(l(),c("button",{key:1,type:"button",class:"input-group-text",id:"basic-addon2",disabled:s.id===e.status.changeCartQtyLoading,onClick:m=>e.changeCartQty(s,s.qty-1)},[n(d,{icon:"minus"})],8,U)),t("span",S,u(s.qty),1),t("button",{type:"button",class:"input-group-text",id:"basic-addon2",disabled:s.id===e.status.changeCartQtyLoading||s.qty===10,onClick:m=>e.changeCartQty(s,s.qty+1)},[n(d,{icon:"plus"})],8,q)])])]),t("td",R,u(s.product.price),1),t("td",T,[s.id===e.status.changeCartQtyLoading?(l(),g(d,{key:0,icon:"fa-solid fa-spinner","spin-pulse":""})):C("",!0),k(" "+u(s.final_total),1)])]))),128)):C("",!0)]),t("tfoot",null,[t("tr",null,[O,t("td",F,u(e.cartData.total),1)])])]),t("div",M,[n(y,{ref:"form",class:"col-md-6",onSubmit:e.onSubmit},{default:w(({errors:s,resetForm:m})=>[t("div",j,[z,n(r,{id:"email",name:"Email",type:"email",class:_(["form-control",{"is-invalid":s.Email}]),placeholder:"請輸入 Email",rules:"required|email",modelValue:e.form.user.email,"onUpdate:modelValue":a[1]||(a[1]=i=>e.form.user.email=i)},null,8,["class","modelValue"]),n(f,{name:"Email",class:"invalid-feedback"})]),t("div",x,[Z,n(r,{id:"name",name:"姓名",type:"text",class:_(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:e.isName,modelValue:e.form.user.name,"onUpdate:modelValue":a[2]||(a[2]=i=>e.form.user.name=i)},null,8,["class","rules","modelValue"]),n(f,{name:"姓名",class:"invalid-feedback"})]),t("div",G,[H,n(r,{id:"tel",name:"電話",type:"tel",class:_(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:e.isPhone,modelValue:e.form.user.tel,"onUpdate:modelValue":a[3]||(a[3]=i=>e.form.user.tel=i)},null,8,["class","rules","modelValue"]),n(f,{name:"電話",class:"invalid-feedback"})]),t("div",J,[K,n(r,{id:"address",name:"地址",type:"text",class:_(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:e.form.user.address,"onUpdate:modelValue":a[4]||(a[4]=i=>e.form.user.address=i)},null,8,["class","modelValue"]),n(f,{name:"地址",class:"invalid-feedback"})]),t("div",W,[X,n(r,{as:"textarea",id:"message",name:"message",type:"text",class:"form-control",cols:"30",rows:"5",modelValue:e.form.message,"onUpdate:modelValue":a[5]||(a[5]=i=>e.form.message=i)},null,8,["modelValue"])]),t("div",Y,[tt,t("button",{type:"button",class:"btn btn-primary ms-2",onClick:m},"重設",8,et)])]),_:1},8,["onSubmit"])])])}}});export{at as default};
